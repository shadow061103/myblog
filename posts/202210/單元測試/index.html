<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9EBLW1S7P3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9EBLW1S7P3');
</script>
    
    
    <title>單元測試</title>
    <meta name="description" content="Embrace your past,it shaped your present.">
    <meta name="keywords" content='blog, gokarna, hugo, 單元測試'>

    <meta property="og:url" content="https://lucumt.info/posts/202210/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="單元測試">
    <meta property="og:description" content="Embrace your past,it shaped your present.">
    <meta property="og:image" content="/images/profile.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="單元測試">
    <meta name="twitter:description" content="Embrace your past,it shaped your present.">
    <meta property="twitter:domain" content="https://lucumt.info/posts/202210/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/">
    <meta property="twitter:url" content="https://lucumt.info/posts/202210/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/">
    <meta name="twitter:image" content="/images/profile.jpg">

    
    <link rel="canonical" href="https://lucumt.info/posts/202210/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6/" />

    <link rel="stylesheet" type="text/css" href="https://lucumt.info//css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://lucumt.info//css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://lucumt.info//css/dark.css">

    <script src="https://lucumt.info//js/svg-injector.min.js"></script>
    <script src="https://lucumt.info//js/feather-icons.min.js"></script>
    <script src="https://lucumt.info//js/main.js"></script>

    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://lucumt.info/">
                <img src="https://lucumt.info//images/profile.jpg" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://lucumt.info/">Steve的技術筆記</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://lucumt.info/"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lucumt.info/posts/"><span data-feather='book'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lucumt.info/favorites/"><span data-feather='code'></span> Favorite </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lucumt.info/tags/"><span data-feather='tag'></span> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/shadow061103"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://lucumt.info/"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lucumt.info/posts/"><span data-feather='book'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lucumt.info/favorites/"><span data-feather='code'></span> Favorite </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lucumt.info/tags/"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/shadow061103"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>單元測試</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            October 24, 2022
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://lucumt.info/tags/%E5%96%AE%E5%85%83%E6%B8%AC%E8%A9%A6">單元測試</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <h2 id="定義">定義</h2>
<ul>
<li>一個測試案例只測一種情境</li>
<li>最小的測試單位</li>
<li>不跟外部資源相依</li>
<li>沒有邏輯判斷</li>
<li>測試案例之間的相依性為0</li>
</ul>
<h2 id="特性first">特性FIRST</h2>
<ul>
<li>Fast：快速。每個單元測試的執行時間應該要很短。</li>
<li>Independent：獨立。單元測試不與外部資源相依，單元測試之間也不能夠相依，要能夠單獨針對測試目標進行測試。</li>
<li>Repeatable：可重複。所有的單元測試都可重複被執行，且不影響預期的結果。</li>
<li>Self-Validating：自我驗證（可反應驗證結果）。單元測試執行不論成功或失敗，都應該要能夠從測試報告裡直接瞭解其意義或失敗的原因。</li>
<li>Timely：及時。單元測試應該在產品程式碼完成的當下就可以驗證執行結果是否符合預期。</li>
</ul>
<h2 id="驗證方式">驗證方式</h2>
<ul>
<li>驗證測試目標物件的方法回傳值是否符合預期</li>
<li>驗證測試目標物件的狀態改變是否符合預期</li>
<li>驗證測試目標物件與相依物件的互動是否符合預期</li>
</ul>
<h2 id="3a原則">3A原則</h2>
<ul>
<li>Arrange
<ul>
<li>初始化目標物件</li>
<li>初始化方法參數</li>
<li>建立模擬物件行為</li>
<li>設定環境變數期望結果</li>
</ul>
</li>
<li>Act
<ul>
<li>實際呼叫測試目標物件的方法</li>
</ul>
</li>
<li>Assert
<ul>
<li>驗證政目標是否如預期運作</li>
</ul>
</li>
</ul>
<h2 id="測試方法的命名">測試方法的命名</h2>
<ul>
<li>被測試方法名稱+測試場景描述+預期行為</li>
<li>可以用中文</li>
<li>受測對象:可使用target或sut(system under test)</li>
<li>預期結果 - expected</li>
<li>實際執行結果 - actual</li>
<li>範例:ToInt_傳入為正整數的物件_應傳回正確的正整數</li>
</ul>
<h3 id="快捷鍵">快捷鍵</h3>
<ul>
<li>testc建立測試類別</li>
<li>testm 建立測試方法</li>
<li>Ctrl+R, T: 執行單一測試</li>
<li>Ctrl+R, A: 執行所有測試（開發時最常使用）</li>
<li>Ctrl+R, Ctrl+T: 偵錯單一測試（測試失敗時，最常使用）</li>
<li>Ctrl+R, Ctrl+A: 偵錯所有測試</li>
</ul>
<h3 id="測試相關標籤attribute">測試相關標籤Attribute</h3>
<ul>
<li>[TestClass()]</li>
<li>[TestMethod()]</li>
<li>[Owenr(“User_Name”)]</li>
<li>[TestCategory(“Calculator”)]</li>
<li>[TestProperty(“Calculator”, “Add”)]</li>
<li>[Ignore]</li>
</ul>
<h3 id="建立群組">建立群組</h3>
<ul>
<li>可以依據類別、持續期間、執行結果、TestCategory內容、測試專案區分群組</li>
<li>也可以建立播放清單</li>
</ul>
<h2 id="assert類別">Assert類別</h2>
<ul>
<li>Assert.AreEqual(expected, actual);</li>
<li>Assert.AreNotEqual(expected, actual);</li>
<li>Assert.IsTrue(actual);</li>
<li>Assert.IsFalse(actual);</li>
<li>Assert.IsNull(actual);</li>
<li>Assert.IsNotNull(actual);</li>
<li>Assert.IsInstanceOfType(actual, typeof(expectedType));</li>
<li>Assert.IsNotInstanceOfType(actual, typeof(wrongType));
驗證集合是否包含指定的項目</li>
<li>CollectionAssert.Contains(actual, element);</li>
<li>CollectionAssert.DoesNotContain(actual, element);
驗證集合的項目與順序是否相等</li>
<li>CollectionAssert.AreEqual(expected, actual);</li>
<li>CollectionAssert.AreNotEqual(expected, actual);
驗證集合的項目是否對等（不按順序）</li>
<li>CollectionAssert.AreEquivalent(expected, actual);</li>
<li>CollectionAssert.AreNotEquivalent(expected, actual);</li>
<li>Assert.AreEquals()方法:確認兩個指定的物件相等，如果這些物件都不相等，判斷提示就會失敗。</li>
<li>Assert.AreSame()方法:確認兩個指定的物件變數參考相同的物件。 如果它們參考不同的物件，判斷提示就會失敗。</li>
</ul>
<h3 id="fluentassertions擴充方法">FluentAssertions擴充方法</h3>
<p><a href="https://fluentassertions.com/introduction">文件連結</a></p>
<h4 id="範例">範例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#a6e22e">[TestMethod()]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> IsNullOrEmpty_傳入空白的字串_Should_be_True()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// arrange</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> sut = <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// act</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> actual = sut.IsNullOrEmpty();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// assert</span>
</span></span><span style="display:flex;"><span>            actual.Should().BeTrue();
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h2 id="privateinternal方法的測試">private,internal方法的測試</h2>
<ul>
<li>盡量不對private方法做測試</li>
<li>如果真的要測試 Private 方法，可使用 PrivateObject 類別或 PrivateType 類別</li>
<li>PrivateObject類別:允許測試程式碼呼叫受測試之程式碼上可能因為不是 public 而無法存取的方法和屬性。</li>
<li>PrivateType類別:表示可用來存取私用靜態實作之私用類別的型別</li>
<li>被測試專案的AssemblyInfo要加上<code>[assembly: InternalsVisibleTo(&quot;測試專案名稱&quot;)] </code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#a6e22e">[TestMethod]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> TestPrivateAdd()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 使用 PrivateObject 類別，測試私有方法 Add</span>
</span></span><span style="display:flex;"><span>            PrivateObject po = <span style="color:#66d9ef">new</span> PrivateObject(<span style="color:#66d9ef">new</span> Calculate());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> expected = <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> actual = po.Invoke(<span style="color:#e6db74">&#34;Add&#34;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.AreEqual(expected, actual);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [TestMethod]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> TestInternalStaticAdd()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 使用 PrivateType 類別，測試靜態Internal方法 AddStatic</span>
</span></span><span style="display:flex;"><span>            PrivateType po = <span style="color:#66d9ef">new</span> PrivateType(<span style="color:#66d9ef">typeof</span>(Calculate));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> expected = <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> actual = po.InvokeStatic(<span style="color:#e6db74">&#34;AddStatic&#34;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.AreEqual(expected, actual);
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h2 id="unit-test-event-hooks">Unit Test Event Hooks</h2>
<ul>
<li>ClassInitializeAttribute 類別: 該方法所包含的程式碼須<strong>用於測試類別中的所有測試都完成執行之前</strong>，以便配置此測試類別所使用的資源。</li>
<li>ClassCleanupAttribute 類別: 該方法所包含的程式碼<strong>用於測試類別中的所有測試都完成執行之後</strong>，以便釋放此測試類別所佔用的資源。</li>
<li>TestInitializeAttribute 類別: 此方法要<strong>在測試之前執行</strong>，以便配置和設定測試類別中所有測試所需的資源。</li>
<li>TestCleanupAttribute 類別: 該方法所包含的程式碼必須<strong>於測試完成執行之後使用</strong>，以便釋放此測試類別中所有測試所佔用的資源。</li>
</ul>
<h2 id="使用-nsubstitute-產生-stub-物件">使用 Nsubstitute 產生 Stub 物件</h2>
<ul>
<li>加入Nsubstisute套件</li>
<li>Substitue.For&lt; T &gt;()產生 Interface的Stub物件</li>
<li>定義Stub物件的行為與回傳值Stub物件.方法(你要輸入參數).Returns(你想要回傳的值)</li>
</ul>
<pre tabindex="0"><code> var profileRepository = Substitute.For&lt;IProfileRepository&gt;();
 profileRepository.GetPassword(account).Returns(&#34;000&#34;);
</code></pre><h4 id="驗證是否有互動-使用received跟didnotreceive">驗證是否有互動 使用Received()跟DidNotReceive()</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> IsValid_驗證為False的情境()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// arrange</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> account = <span style="color:#e6db74">&#34;kevin&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> validateCode = <span style="color:#e6db74">&#34;000222&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> profileRepository = Substitute.For&lt;IProfileRepository&gt;();
</span></span><span style="display:flex;"><span>            profileRepository.GetPassword(account).Returns(<span style="color:#e6db74">&#34;000&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> hashTokenService = Substitute.For&lt;IHashTokenService&gt;();
</span></span><span style="display:flex;"><span>            hashTokenService.GetRandom(account).Returns(<span style="color:#e6db74">&#34;111&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// step 1: arrange, 建立 mock object</span>
</span></span><span style="display:flex;"><span>            ILog log = Substitute.For&lt;ILog&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> sut = <span style="color:#66d9ef">new</span> AuthenticationService(profileRepository, hashTokenService, log);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Step 2: act</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> actual = sut.IsValid(account, validateCode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// step 3: assert, mock object 是否有正確互動</span>
</span></span><span style="display:flex;"><span>            actual.Should().BeFalse();
</span></span><span style="display:flex;"><span>            log.Received(<span style="color:#ae81ff">1</span>).Save(Arg.Is&lt;<span style="color:#66d9ef">string</span>&gt;(x =&gt; x.Contains(account)));
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h2 id="expected-object">Expected Object</h2>
<blockquote>
<p>比對兩個物件是否相等 <a href="https://github.com/derekgreer/expectedObjects">https://github.com/derekgreer/expectedObjects</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> TestComposedObject()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> expectedPerson = <span style="color:#66d9ef">new</span> Person
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                Id = <span style="color:#ae81ff">1234</span>,
</span></span><span style="display:flex;"><span>                Name = <span style="color:#e6db74">&#34;Boo&#34;</span>,
</span></span><span style="display:flex;"><span>                Order = <span style="color:#66d9ef">new</span> Order { Id = <span style="color:#ae81ff">101</span>, Price = <span style="color:#ae81ff">201</span> }
</span></span><span style="display:flex;"><span>            }.ToExpectedObject();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> actualPerson = <span style="color:#66d9ef">new</span> Person
</span></span><span style="display:flex;"><span>                               {
</span></span><span style="display:flex;"><span>                                   Id = <span style="color:#ae81ff">1234</span>,
</span></span><span style="display:flex;"><span>                                   Name = <span style="color:#e6db74">&#34;Boo&#34;</span>,
</span></span><span style="display:flex;"><span>                                   Order = <span style="color:#66d9ef">new</span> Order { Id = <span style="color:#ae81ff">101</span>, Price = <span style="color:#ae81ff">201</span> }
</span></span><span style="display:flex;"><span>                               };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           <span style="color:#75715e">//Assert.AreEqual(expectedPerson, actualPerson);</span>
</span></span><span style="display:flex;"><span>            expectedPerson.ShouldEqual(actualPerson);
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//比較不完全相同物件用這個方法</span>
</span></span><span style="display:flex;"><span>             expected.ShouldMatch(actual);
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h2 id="產生測試資料">產生測試資料</h2>
<h3 id="autofixture">AutoFixture</h3>
<blockquote>
<p><a href="https://github.com/AutoFixture/AutoFixture">https://github.com/AutoFixture/AutoFixture</a>
範例</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task UpdateAsync_傳入一筆帳戶主檔_修改成功應回傳1()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//arrange</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> fixture = <span style="color:#66d9ef">new</span> Fixture();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> sut = <span style="color:#66d9ef">this</span>.GetSystemUnderTest();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> accountDto = fixture.Build&lt;AccountDto&gt;()
</span></span><span style="display:flex;"><span>                .OmitAutoProperties()
</span></span><span style="display:flex;"><span>                .Create();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> account = fixture.Build&lt;Account&gt;()
</span></span><span style="display:flex;"><span>                .OmitAutoProperties()
</span></span><span style="display:flex;"><span>                .CreateMany(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>                .AsQueryable()
</span></span><span style="display:flex;"><span>                .BuildMock();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#ae81ff">_</span>uow.GetRepository&lt;Account&gt;()
</span></span><span style="display:flex;"><span>                .Get(Arg.Any&lt;Expression&lt;Func&lt;Account, <span style="color:#66d9ef">bool</span>&gt;&gt;&gt;())
</span></span><span style="display:flex;"><span>                .Returns(account);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#ae81ff">_</span>uow.SaveChangesAsync().Returns(Task.FromResult(<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//act</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> actual = <span style="color:#66d9ef">await</span> sut.UpdateAsync(accountDto);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//assert</span>
</span></span><span style="display:flex;"><span>            actual.Should().Be(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> UpdateAsync_傳入一筆資料_查無此筆資料應拋出ObjectNotFoundException()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//arrange</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> sut = <span style="color:#66d9ef">this</span>.GetSystemUnderTest();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> fixture = <span style="color:#66d9ef">new</span> Fixture();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> accountDto = fixture.Build&lt;AccountDto&gt;()
</span></span><span style="display:flex;"><span>                .OmitAutoProperties()
</span></span><span style="display:flex;"><span>                .Create();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> account = <span style="color:#66d9ef">new</span> List&lt;Account&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> mock = account.AsQueryable().BuildMock();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#ae81ff">_</span>uow.GetRepository&lt;Account&gt;()
</span></span><span style="display:flex;"><span>                .Get(Arg.Any&lt;Expression&lt;Func&lt;Account, <span style="color:#66d9ef">bool</span>&gt;&gt;&gt;())
</span></span><span style="display:flex;"><span>                .Returns(mock);
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//act</span>
</span></span><span style="display:flex;"><span>            Func&lt;Task&gt; action = <span style="color:#66d9ef">async</span> () =&gt; <span style="color:#66d9ef">await</span> sut.UpdateAsync(accountDto);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//assert</span>
</span></span><span style="display:flex;"><span>            action.Should().Throw&lt;ObjectNotFoundException&gt;()
</span></span><span style="display:flex;"><span>                .Where(e =&gt; e.Message.Contains(<span style="color:#e6db74">$&#34;找不到帳戶主檔&#34;</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [TestMethod()]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> RelativeSortArrayTest_輸入IP字串超過5_應拋出ArgumentException()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//arrange</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> fixture = <span style="color:#66d9ef">new</span> Fixture();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> model = fixture.Build&lt;InputParameter&gt;().With(c =&gt; c.IP, <span style="color:#e6db74">&#34;123456&#34;</span>).Create();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> sut = GetSystemUnderTest();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//act</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> exception = Assert.ThrowsException&lt;ArgumentException&gt;(
</span></span><span style="display:flex;"><span>                () =&gt; sut.RelativeSortArray(model));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//assert</span>
</span></span><span style="display:flex;"><span>            exception.ParamName.Should().Be(<span style="color:#e6db74">&#34;IP&#34;</span>);
</span></span><span style="display:flex;"><span>            exception.Message.Should().Contain(<span style="color:#e6db74">&#34;The field IP must be a string with a maximum length of 5.&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h3 id="xunit">XUnit</h3>
<ul>
<li><code>[Fact]</code>:標註為測試方法，不能有傳入參數</li>
<li><code>[Theory]</code>: 代表執行相同程式碼但具有不同輸入引數的測試套件，可以用InlineData傳入測試參數</li>
<li><code>[InlineData]</code>: 屬性會指定這些輸入的值。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#a6e22e">[Fact]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> IsPrime_InputIs1_ReturnFalse()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> primeService = <span style="color:#66d9ef">new</span> PrimeService();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> result = primeService.IsPrime(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Assert.False(result, <span style="color:#e6db74">&#34;1 should not be prime&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[Theory]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(-1)]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(0)]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(1)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> IsPrime_ValuesLessThan2_ReturnFalse(<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">value</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> result = <span style="color:#ae81ff">_</span>primeService.IsPrime(<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Assert.False(result, <span style="color:#e6db74">$&#34;{value} should not be prime&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
        </p>
    </div>
    <div class="disqus markdown">
        <div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://steveskillblog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
</div>



    

        </main><footer class="footer">
    <span>&copy; 2022 The Steve&#39;s skill blog</span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
