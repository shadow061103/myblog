<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9EBLW1S7P3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9EBLW1S7P3');
</script>
    
    
    <title>Csharp本事筆記</title>
    <meta name="description" content="Embrace your past,it shaped your present.">
    <meta name="keywords" content='blog, gokarna, hugo, Csharp'>

    <meta property="og:url" content="https://lucumt.info/posts/202210/csharp%E6%9C%AC%E4%BA%8B%E7%AD%86%E8%A8%98/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Csharp本事筆記">
    <meta property="og:description" content="Embrace your past,it shaped your present.">
    <meta property="og:image" content="/images/profile.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Csharp本事筆記">
    <meta name="twitter:description" content="Embrace your past,it shaped your present.">
    <meta property="twitter:domain" content="https://lucumt.info/posts/202210/csharp%E6%9C%AC%E4%BA%8B%E7%AD%86%E8%A8%98/">
    <meta property="twitter:url" content="https://lucumt.info/posts/202210/csharp%E6%9C%AC%E4%BA%8B%E7%AD%86%E8%A8%98/">
    <meta name="twitter:image" content="/images/profile.jpg">

    
    <link rel="canonical" href="https://lucumt.info/posts/202210/csharp%E6%9C%AC%E4%BA%8B%E7%AD%86%E8%A8%98/" />

    <link rel="stylesheet" type="text/css" href="https://lucumt.info//css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://lucumt.info//css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://lucumt.info//css/dark.css">

    <script src="https://lucumt.info//js/svg-injector.min.js"></script>
    <script src="https://lucumt.info//js/feather-icons.min.js"></script>
    <script src="https://lucumt.info//js/main.js"></script>

    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://lucumt.info/">
                <img src="https://lucumt.info//images/profile.jpg" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://lucumt.info/">Steve的技術筆記</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://lucumt.info/"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lucumt.info/posts/"><span data-feather='book'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lucumt.info/favorites/"><span data-feather='code'></span> Favorite </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lucumt.info/tags/"><span data-feather='tag'></span> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/shadow061103"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://lucumt.info/"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lucumt.info/posts/"><span data-feather='book'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lucumt.info/favorites/"><span data-feather='code'></span> Favorite </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lucumt.info/tags/"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/shadow061103"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Csharp本事筆記</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            October 20, 2022
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://lucumt.info/tags/csharp">Csharp</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <h3 id="共變性逆變性">共變性逆變性</h3>
<ul>
<li>無法在編譯時期抓出型別不相容的錯誤</li>
<li>泛型可以把小的型別當作大的來操作，但因為宣告是<code>&lt;out T&gt;</code>，所以只能用在輸出的場合</li>
<li>任何參考型別（reference type）的泛型串列，你都可以將它當作<code>IEnumerable&lt;object&gt;</code>的物件來操作</li>
<li>共變性:把較小型別指派給較大型別</li>
<li>逆變性:把較大型別指派給較小型別</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>List&lt;<span style="color:#66d9ef">string</span>&gt; stringList = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>List&lt;<span style="color:#66d9ef">object</span>&gt; objectList = stringList; <span style="color:#75715e">// 即使C# 4 也不能這樣寫!</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">但是可以</span>
</span></span><span style="display:flex;"><span>List&lt;<span style="color:#66d9ef">string</span>&gt; stringList = <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>IEnumerable&lt;<span style="color:#66d9ef">object</span>&gt; objects = stringList;
</span></span></code></pre></div><h5 id="ienumerablet都是唯讀的可以當作參數使用"><code>IEnumerable&lt;T&gt;</code>都是唯讀的，可以當作參數使用</h5>
<h3 id="nullable">nullable</h3>
<ul>
<li>只有實質型別可以用Nullable&lt; T&gt;</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">int?</span> x = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int?</span> y= x ?? <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//等同於</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int?</span> y= =(x != <span style="color:#66d9ef">null</span>)? x : <span style="color:#ae81ff">5</span>;
</span></span></code></pre></div><h3 id="委派">委派</h3>
<blockquote>
<p>可以在方法裡外包一個函式，方法在執行的時候可以回頭呼叫那個涵式</p>
</blockquote>
<ul>
<li>C#內建委派
<ul>
<li>Action&lt;in T1, in T2, in T3&gt;(T1 arg1, T2 arg2, T3 arg3, T4 arg4) 無回傳值</li>
<li>TResult Func&lt;in T1, in T2, out TResult&gt;(T1 arg1, T2 arg2); 有回傳值
<img src="https://imgur.com/EipJksD.jpg" alt=""></li>
</ul>
</li>
</ul>
<h3 id="事件">事件</h3>
<blockquote>
<p>基於委派衍生出來的語法</p>
</blockquote>
<ul>
<li>加上event關鍵字，就只能在publisher使用</li>
<li>不要有回傳值，因為可能有很多訂閱者，也不要用ref或out傳參數給發行者，因為參數可能被任意改變</li>
<li>使用EventArgs包裝參數</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">delegate</span> <span style="color:#66d9ef">void</span> TextChangedEventHandler(<span style="color:#66d9ef">object</span> sender, EventArgs args);
</span></span></code></pre></div><ul>
<li>可以使用內建的EventHandler</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">delegate</span> <span style="color:#66d9ef">void</span> EventHandler(<span style="color:#66d9ef">object</span> sender, EventArgs eventArgs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//宣告</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler TextChanged;
</span></span></code></pre></div><ul>
<li>觸發事件的時候要先檢查是否null</li>
<li>EventHandlerList可以集中管理事件</li>
</ul>
<h3 id="委派與事件">委派與事件</h3>
<h4 id="相同">相同</h4>
<ul>
<li>支援晚期繫結</li>
<li>支援一個或多個訂閱者</li>
<li>加入與移除處理常式（handler）的語法雷同</li>
<li>都是透過方法呼叫來觸發事件和呼叫委派</li>
</ul>
<h4 id="相異">相異</h4>
<ul>
<li>事件不一定要有訂閱者
在設計元件時，如果你的元件必須呼叫訂閱者提供的方法，那麼就應該選擇使用委派。相反地，就算沒有任何訂閱者，你的元件依然能夠獨自完成所需之任務，那麼就該選擇事件</li>
<li>需要回傳值的時候，必須使用委派
宣告委派的時候，其方法可以傳回值，也可以不傳回值；而用來定義事件的委派型別，其方法通常會宣告成void，亦即沒有回傳值</li>
</ul>
<h3 id="tuple">Tuple</h3>
<ul>
<li>舊寫法，要用item1、item2取值</li>
<li>System.Tuple類別(參考型別)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> Tuple&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">int</span>&gt; GetInfo()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Tuple&lt;<span style="color:#66d9ef">string</span>,<span style="color:#66d9ef">int</span>&gt;(<span style="color:#e6db74">&#34;AAA&#34;</span>,<span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> t=GetInfo();
</span></span><span style="display:flex;"><span>t.Item1.Dump();
</span></span></code></pre></div><ul>
<li>新寫法可以自訂名稱</li>
<li>System.ValueTuple(結構型別)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> (<span style="color:#66d9ef">string</span> name,<span style="color:#66d9ef">int</span> age) GetInfo2()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#34;BBB&#34;</span>,<span style="color:#ae81ff">60</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> t3=GetInfo2();
</span></span><span style="display:flex;"><span>t3.name.Dump();
</span></span></code></pre></div><ul>
<li>自動推導名稱，但名稱不能重複</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">string</span> name = <span style="color:#e6db74">&#34;mike&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> age = <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> tuple = (Name: name, Age: age);<span style="color:#75715e">// 明確指定元素名稱</span>
</span></span><span style="display:flex;"><span>tuple = (name, age); <span style="color:#75715e">// 自動推導元素名稱</span>
</span></span></code></pre></div><h3 id="分解式">分解式</h3>
<ul>
<li>可以把類別物件或Tuple分解給一或多個變數</li>
<li>方法名稱一定要使用Deconstruct</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Box</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Width {<span style="color:#66d9ef">get</span>;<span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Height {<span style="color:#66d9ef">get</span>;<span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Box(<span style="color:#66d9ef">int</span> width,<span style="color:#66d9ef">int</span> height)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		Width=width;
</span></span><span style="display:flex;"><span>		Height=height;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Deconstruct(<span style="color:#66d9ef">out</span> <span style="color:#66d9ef">int</span> width, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">int</span> height)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		width=<span style="color:#66d9ef">this</span>.Width;
</span></span><span style="display:flex;"><span>		height=<span style="color:#66d9ef">this</span>.Height;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//console</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> box=<span style="color:#66d9ef">new</span> Box(<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (width,height)=box;
</span></span></code></pre></div><h4 id="c-7新語法">C# 7新語法</h4>
<ul>
<li>可以使用when了</li>
</ul>
<pre tabindex="0"><code>case int[] numbers when numbers.Length &gt; 0:
Box box when (box.Width &gt; 0)
</code></pre><ul>
<li>is可以指派變數</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (aa <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">string</span> s)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		aa=<span style="color:#e6db74">&#34;BBB&#34;</span>;
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><ul>
<li>ref local 有點類似替身的概念</li>
</ul>
<pre tabindex="0"><code>int temp=0;
ref int alias=ref temp;
</code></pre><ul>
<li>ref return</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#ae81ff">_</span>number=<span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">ref</span> <span style="color:#66d9ef">int</span> refreturn()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">ref</span> <span style="color:#ae81ff">_</span>number;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//接值</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ref</span> <span style="color:#66d9ef">int</span> n=<span style="color:#66d9ef">ref</span> refreturn();
</span></span></code></pre></div><ul>
<li>ref readonly可以禁止修改值</li>
<li>in參數:是傳參考的且唯讀，等於readonly ref，可以改善程式效率</li>
<li>private protecter:類別本身與同一組建內子類別存取</li>
</ul>
<h3 id="linq">Linq</h3>
<ul>
<li>惰性求值，只有以下狀況才會啟動查詢
<ul>
<li>傳回單一元素或數值的操作，例如Count()、First()、Max()</li>
<li>有內容轉換有關的的操作，例如：ToArray()、ToList()、ToDictionary()、ToLookup()</li>
</ul>
</li>
</ul>

        </p>
    </div>
    <div class="disqus markdown">
        <div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://steveskillblog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
</div>



    

        </main><footer class="footer">
    <span>&copy; 2022 The Steve&#39;s skill blog</span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
